-- movie
DROP SCHEMA movie;

-- movie
CREATE SCHEMA movie;

-- address
CREATE TABLE movie.address (
	addrNo    CHAR(5)     NULL, -- 우편번호
	sido      VARCHAR(20) NULL, -- 시도
	sigungu   VARCHAR(20) NULL, -- 시군구
	doro      VARCHAR(20) NULL, -- 도로
	building1 INT(5)      NULL, -- 건물번호1
	building2 INT(5)      NULL  -- 건물번호2
);

-- board
CREATE TABLE movie.board (
	board_no      INT(11)      NOT NULL, -- 게시판번호
	user_id       VARCHAR(50)  NOT NULL, -- 회원id
	movie_no      INT(11)      NOT NULL, -- 영화_no
	board_title   VARCHAR(255) NOT NULL, -- 게시판제목
	board_content TEXT         NULL,     -- 게시판내용
	regdate       DATE         NOT NULL, -- 등록일
	grade         INT(11)      NULL      -- 개인별점
);

-- board
ALTER TABLE movie.board
	ADD CONSTRAINT
		PRIMARY KEY (
			board_no -- 게시판번호
		);

-- movie
CREATE TABLE movie.movie (
	movie_no      INT(11)      NOT NULL, -- 영화_no
	movie_name    VARCHAR(50)  NOT NULL, -- 영화이름
	path_poster   VARCHAR(255) NULL,     -- 포스터
	play_time     INT(11)      NULL,     -- 상영시간
	rating        INT(11)      NULL,     -- 등급
	grade         DOUBLE       NULL,     -- 총평점
	open_date     DATE         NULL,     -- 개봉일
	close_date    DATE         NULL,     -- 종료일
	genre         VARCHAR(255) NULL,     -- 장르
	path_steelcut VARCHAR(255) NULL,     -- 스틸컷
	path_video    VARCHAR(255) NULL,     -- 동영상
	synopsis      TEXT         NULL,     -- 줄거리
	actor         VARCHAR(255) NULL,     -- 배우
	director      VARCHAR(255) NULL      -- 감독
);

-- movie
ALTER TABLE movie.movie
	ADD CONSTRAINT
		PRIMARY KEY (
			movie_no -- 영화_no
		);

-- reservation
CREATE TABLE movie.reservation (
	no           INT(11)      NOT NULL, -- 예약번호
	user_id      VARCHAR(50)  NOT NULL, -- 회원id
	timetable_no INT(11)      NOT NULL, -- 상영시간표_no
	price        INT(11)      NOT NULL, -- 가격
	seat_rank    VARCHAR(255) NOT NULL  -- 좌석등급
);

-- reservation
ALTER TABLE movie.reservation
	ADD CONSTRAINT
		PRIMARY KEY (
			no -- 예약번호
		);

-- theater
CREATE TABLE movie.theater (
	theater_no       INT(11)      NOT NULL, -- theater_no
	theather_name    VARCHAR(255) NOT NULL, -- 이름
	theater_floor    INT(11)      NOT NULL, -- 층수
	theater_maxcount INT(11)      NOT NULL, -- 인원
	seat_a           INT(11)      NOT NULL, -- 좌석A
	seat_b           INT(11)      NULL,     -- 좌석B
	seat_c           INT(11)      NULL,     -- 좌석C
	theater_type     VARCHAR(255) NOT NULL  -- 상영관종류
);

-- theater
ALTER TABLE movie.theater
	ADD CONSTRAINT
		PRIMARY KEY (
			theater_no -- theater_no
		);

-- timetable
CREATE TABLE movie.timetable (
	table_no   INT(11) NOT NULL, -- 시간표no
	movie_no   INT(11) NOT NULL, -- 영화_no
	theater_no INT(11) NOT NULL, -- 상영관_no
	start_time DATE    NOT NULL, -- 방영시작시간
	end_time   DATE    NOT NULL  -- 방영종료시간
);

-- timetable
ALTER TABLE movie.timetable
	ADD CONSTRAINT
		PRIMARY KEY (
			table_no -- 시간표no
		);

-- user
CREATE TABLE movie.user (
	user_id   VARCHAR(50)  NOT NULL, -- 회원id
	password  VARCHAR(50)  NOT NULL, -- 비밀번호
	point     INT(11)      NULL,     -- 포인트
	email     VARCHAR(50)  NOT NULL, -- email
	phone     INT(11)      NOT NULL, -- 전화번호
	addr      VARCHAR(255) NOT NULL, -- 주소
	gender    VARCHAR(50)  NOT NULL, -- 성별
	user_rank VARCHAR(50)  NULL      -- 회원등급
);

-- user
ALTER TABLE movie.user
	ADD CONSTRAINT
		PRIMARY KEY (
			user_id -- 회원id
		);

-- user_rank
CREATE TABLE movie.user_rank (
	name     VARCHAR(50) NOT NULL, -- name
	discount INT(11)     NULL      -- discount
);

-- user_rank
ALTER TABLE movie.user_rank
	ADD CONSTRAINT
		PRIMARY KEY (
			name -- name
		);

-- board
ALTER TABLE movie.board
	ADD CONSTRAINT FK_movie_TO_board -- FK_movie_TO_board
		FOREIGN KEY (
			movie_no -- 영화_no
		)
		REFERENCES movie.movie ( -- movie
			movie_no -- 영화_no
		),
	ADD INDEX FK_movie_TO_board (
		movie_no -- 영화_no
	);

-- board
ALTER TABLE movie.board
	ADD CONSTRAINT FK_user_TO_board -- FK_user_TO_board
		FOREIGN KEY (
			user_id -- 회원id
		)
		REFERENCES movie.user ( -- user
			user_id -- 회원id
		),
	ADD INDEX FK_user_TO_board (
		user_id -- 회원id
	);

-- reservation
ALTER TABLE movie.reservation
	ADD CONSTRAINT FK_timetable_TO_reservation -- FK_timetable_TO_reservation
		FOREIGN KEY (
			timetable_no -- 상영시간표_no
		)
		REFERENCES movie.timetable ( -- timetable
			table_no -- 시간표no
		),
	ADD INDEX FK_timetable_TO_reservation (
		timetable_no -- 상영시간표_no
	);

-- reservation
ALTER TABLE movie.reservation
	ADD CONSTRAINT FK_user_TO_reservation -- FK_user_TO_reservation
		FOREIGN KEY (
			user_id -- 회원id
		)
		REFERENCES movie.user ( -- user
			user_id -- 회원id
		),
	ADD INDEX FK_user_TO_reservation (
		user_id -- 회원id
	);

-- timetable
ALTER TABLE movie.timetable
	ADD CONSTRAINT FK_movie_TO_timetable -- FK_movie_TO_timetable
		FOREIGN KEY (
			movie_no -- 영화_no
		)
		REFERENCES movie.movie ( -- movie
			movie_no -- 영화_no
		),
	ADD INDEX FK_movie_TO_timetable (
		movie_no -- 영화_no
	);

-- timetable
ALTER TABLE movie.timetable
	ADD CONSTRAINT FK_theater_TO_timetable -- FK_theater_TO_timetable
		FOREIGN KEY (
			theater_no -- 상영관_no
		)
		REFERENCES movie.theater ( -- theater
			theater_no -- theater_no
		),
	ADD INDEX FK_theater_TO_timetable (
		theater_no -- 상영관_no
	);

-- user
ALTER TABLE movie.user
	ADD CONSTRAINT FK_user_rank_TO_user -- FK_user_rank_TO_user
		FOREIGN KEY (
			user_rank -- 회원등급
		)
		REFERENCES movie.user_rank ( -- user_rank
			name -- name
		),
	ADD INDEX FK_user_rank_TO_user (
		user_rank -- 회원등급
	);